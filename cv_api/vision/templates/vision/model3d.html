{% extends "vision/base.html" %}

{% block title %}3D Model{% endblock %}

{% block content %}
<h2 class="text-xl font-bold mb-4">3D Object Detection</h2>
<form id="3d-form" class="mb-6">
    {% csrf_token %}
    <input type="file" name="image" accept="image/*" class="mb-4 border p-2 w-full rounded" required>
    <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
        Detect 3D Objects
    </button>
</form>

<div id="3d-result" class="hidden">
    <div class="p-3 bg-green-100 text-green-800 rounded mb-4">
        <p><strong>Detected 3D Objects:</strong></p>
        <div id="3d-objects" class="mt-2"></div>
        <p class="mt-2"><strong>Processing Time:</strong> <span id="3d-processing-time"></span>s</p>
    </div>
    <div id="3d-image" class="mt-4"></div>
</div>

<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<script>
document.getElementById('3d-form').addEventListener('submit', async function(e) {
    e.preventDefault();
    const formData = new FormData(this);
    
    try {
        const response = await axios.post('/api/3d/', formData, {
            headers: {
                'Content-Type': 'multipart/form-data',
            }
        });
        
        const result = response.data;
        
        const objectsHtml = result.objects_3d.map(obj => 
            `<div class="mb-2">
                <strong>${obj.class}</strong> (${(obj.confidence * 100).toFixed(1)}%)
                <br><small>Depth: ${obj.depth}m, Position: [${obj.position.join(', ')}]</small>
            </div>`
        ).join('');
        
        document.getElementById('3d-objects').innerHTML = objectsHtml;
        document.getElementById('3d-processing-time').textContent = result.processing_time;
        
        document.getElementById('3d-image').innerHTML = 
            `<img src="${result.image_url}" class="rounded shadow-md max-w-sm" alt="Uploaded Image">`;
        
        document.getElementById('3d-result').classList.remove('hidden');
    } catch (error) {
        alert('Error: ' + (error.response?.data?.error || 'Unknown error occurred'));
    }
});
</script>
{% endblock %}
